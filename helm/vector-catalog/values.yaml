# ══════════════════════════════════════════════════════════════════════════════
# Vector Catalog Service - Helm Chart Values
# ══════════════════════════════════════════════════════════════════════════════

# ── API Service Configuration ─────────────────────────────────────────────────
api:
  name: vector-catalog-api
  replicaCount: 2
  image:
    repository: ghcr.io/ritunjay/vector-catalog-api
    tag: "0.2.0"
    pullPolicy: IfNotPresent

  service:
    type: LoadBalancer
    port: 80
    targetPort: 8080
    annotations: {}

  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 2Gi

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  env:
    - name: ASPNETCORE_ENVIRONMENT
      value: "Production"
    - name: ASPNETCORE_URLS
      value: "http://+:8080"
    - name: VectorCatalog__Redis__ConnectionString
      value: "redis-service:6379"
    - name: VectorCatalog__Sidecar__GrpcEndpoint
      value: "http://vector-catalog-sidecar:50051"
    - name: OpenTelemetry__ServiceName
      value: "vector-catalog-api"
    - name: OpenTelemetry__ServiceVersion
      value: "0.2.0"
    - name: OpenTelemetry__JaegerEndpoint
      value: "http://jaeger-collector:14268/api/traces"

  healthCheck:
    livenessProbe:
      httpGet:
        path: /health/live
        port: 8080
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      httpGet:
        path: /health/ready
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3

# ── Sidecar (FAISS + Embedding) Configuration ─────────────────────────────────
sidecar:
  name: vector-catalog-sidecar
  replicaCount: 3
  image:
    repository: ghcr.io/ritunjay/vector-catalog-sidecar
    tag: "0.2.0"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 50051
    targetPort: 50051

  resources:
    requests:
      cpu: 1000m
      memory: 4Gi
    limits:
      cpu: 4000m
      memory: 8Gi

  # Persistent Volume Claim for FAISS index storage
  persistence:
    enabled: true
    storageClass: "managed-csi"  # AKS managed disk
    accessMode: ReadOnlyMany     # Multiple pods read same index
    size: 50Gi                   # 100M vectors × 384D × 4 bytes ≈ 150GB compressed to ~50GB with IVF-PQ

  env:
    - name: FAISS_INDEX_PATH
      value: "/data/faiss/nyc_taxi_2023.index"
    - name: EMBEDDING_MODEL
      value: "all-MiniLM-L6-v2"
    - name: GRPC_PORT
      value: "50051"

  healthCheck:
    livenessProbe:
      exec:
        command: ["/bin/grpc_health_probe", "-addr=:50051"]
      initialDelaySeconds: 60
      periodSeconds: 15
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      exec:
        command: ["/bin/grpc_health_probe", "-addr=:50051"]
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# ── Redis Configuration (for query result caching) ────────────────────────────
redis:
  enabled: true
  name: redis
  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 6379

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# ── Jaeger (Distributed Tracing) ──────────────────────────────────────────────
jaeger:
  enabled: true
  name: jaeger
  image:
    repository: jaegertracing/all-in-one
    tag: "1.57"
    pullPolicy: IfNotPresent

  service:
    type: LoadBalancer
    ports:
      ui: 16686
      collector: 14268
      zipkin: 9411

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# ── Prometheus (Metrics Collection) ───────────────────────────────────────────
prometheus:
  enabled: true
  scrapeInterval: 15s

# ── Global Settings ───────────────────────────────────────────────────────────
global:
  namespace: vector-catalog
  imagePullSecrets: []

# ── Node Affinity (for production workload isolation) ─────────────────────────
nodeSelector: {}

tolerations: []

affinity: {}
